# Visual Guide - Two-Way DB Sync POC

## ğŸ¨ System Overview Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TWO-WAY SYNC SYSTEM                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LEGACY PLATFORM        â”‚              â”‚  REVAMPED PLATFORM      â”‚
â”‚  (PostgreSQL 15)        â”‚              â”‚  (MySQL 8.0)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ legacy_users          â”‚              â”‚ â€¢ revamp_users          â”‚
â”‚ â€¢ legacy_posts          â”‚              â”‚ â€¢ revamp_posts          â”‚
â”‚ â€¢ legacy_likes          â”‚              â”‚ â€¢ revamp_likes          â”‚
â”‚                         â”‚              â”‚                         â”‚
â”‚ Column: source          â”‚              â”‚ Column: source          â”‚
â”‚ Values: legacy,         â”‚              â”‚ Values: revamp,         â”‚
â”‚         sync_service    â”‚              â”‚         sync_service    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                        â”‚
           â”‚ CDC (Debezium)                         â”‚ CDC (Debezium)
           â”‚ Filter: source != 'sync_service'       â”‚ Filter: source != 'sync_service'
           â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          APACHE KAFKA (Event Bus)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Topics:                                                                 â”‚
â”‚  â€¢ legacy.public.legacy_users    â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â€¢ legacy.public.legacy_posts           â”‚                                â”‚
â”‚  â€¢ legacy.public.legacy_likes           â”‚                                â”‚
â”‚                                         â”‚                                â”‚
â”‚  â€¢ revamp.revamp_db.revamp_users  â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â€¢ revamp.revamp_db.revamp_posts        â”‚      â”‚                        â”‚
â”‚  â€¢ revamp.revamp_db.revamp_likes        â”‚      â”‚                        â”‚
â”‚                                         â”‚      â”‚                        â”‚
â”‚  â€¢ sync.dlq (Dead Letter Queue)         â”‚      â”‚                        â”‚
â”‚                                         â”‚      â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚      â”‚
                                          â–¼      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LARAVEL SYNC SERVICE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ LegacyEventConsumer    â”‚         â”‚ RevampEventConsumer    â”‚          â”‚
â”‚  â”‚                        â”‚         â”‚                        â”‚          â”‚
â”‚  â”‚ Consumes from:         â”‚         â”‚ Consumes from:         â”‚          â”‚
â”‚  â”‚ â€¢ legacy.* topics      â”‚         â”‚ â€¢ revamp.* topics      â”‚          â”‚
â”‚  â”‚                        â”‚         â”‚                        â”‚          â”‚
â”‚  â”‚ â”Œâ”€ Loop Prevention â”€â”  â”‚         â”‚ â”Œâ”€ Loop Prevention â”€â”  â”‚          â”‚
â”‚  â”‚ â”‚ Skip if source =   â”‚  â”‚         â”‚ â”‚ Skip if source =   â”‚  â”‚          â”‚
â”‚  â”‚ â”‚ 'sync_service'     â”‚  â”‚         â”‚ â”‚ 'sync_service'     â”‚  â”‚          â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚              â”‚                                   â”‚                       â”‚
â”‚              â–¼                                   â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚              TRANSFORMATION LAYER                         â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ â€¢ LegacyToRevampMapper  (Postgres â†’ MySQL)              â”‚           â”‚
â”‚  â”‚ â€¢ RevampToLegacyMapper  (MySQL â†’ Postgres)              â”‚           â”‚
â”‚  â”‚                                                          â”‚           â”‚
â”‚  â”‚ Schema Mapping:                                          â”‚           â”‚
â”‚  â”‚   username âŸ· user_name                                  â”‚           â”‚
â”‚  â”‚   email âŸ· email_address                                 â”‚           â”‚
â”‚  â”‚   full_name âŸ· display_name                              â”‚           â”‚
â”‚  â”‚   phone_number âŸ· mobile                                 â”‚           â”‚
â”‚  â”‚   status âŸ· account_status                               â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                         â”‚                                               â”‚
â”‚                         â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚              IDEMPOTENT WRITERS                           â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ â€¢ IdempotentLegacyWriter (UPSERT to Postgres)           â”‚           â”‚
â”‚  â”‚ â€¢ IdempotentRevampWriter (UPSERT to MySQL)              â”‚           â”‚
â”‚  â”‚                                                          â”‚           â”‚
â”‚  â”‚ Responsibilities:                                        â”‚           â”‚
â”‚  â”‚   - UPSERT operations (no duplicates)                   â”‚           â”‚
â”‚  â”‚   - Set source = 'sync_service'                         â”‚           â”‚
â”‚  â”‚   - Update entity_mappings                              â”‚           â”‚
â”‚  â”‚   - Track processed_events                              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                         â”‚                                               â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚              â–¼                     â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ Error Handler   â”‚    â”‚ DLQ Handler     â”‚                            â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚                            â”‚
â”‚  â”‚ â€¢ Retry with    â”‚    â”‚ â€¢ Send failed   â”‚                            â”‚
â”‚  â”‚   exponential   â”‚    â”‚   events to DLQ â”‚                            â”‚
â”‚  â”‚   backoff       â”‚    â”‚ â€¢ Include error â”‚                            â”‚
â”‚  â”‚ â€¢ Max 3 retries â”‚    â”‚   metadata      â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                   â”‚
               â”‚ Write (source='sync_service')     â”‚ Write (source='sync_service')
               â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL (Revamped)       â”‚              â”‚  PostgreSQL (Legacy)    â”‚
â”‚  NO event published     â”‚              â”‚  NO event published     â”‚
â”‚  (Loop Prevented âœ“)     â”‚              â”‚  (Loop Prevented âœ“)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow Visualization

### Flow 1: Legacy â†’ Revamp

```
Step 1: Direct Insert
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL (Legacy DB)              â”‚
â”‚                                     â”‚
â”‚ INSERT INTO legacy_users            â”‚
â”‚ VALUES (..., source='legacy')       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
Step 2: CDC Capture
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Debezium PostgreSQL Connector       â”‚
â”‚                                     â”‚
â”‚ âœ“ Check: source != 'sync_service'  â”‚
â”‚ âœ“ Transform to CDC event            â”‚
â”‚ âœ“ Publish to Kafka                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
Step 3: Event Transport
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Kafka Topic                         â”‚
â”‚ legacy.public.legacy_users          â”‚
â”‚                                     â”‚
â”‚ Event: {                            â”‚
â”‚   id: 123,                          â”‚
â”‚   username: "john",                 â”‚
â”‚   source: "legacy", â† Important!    â”‚
â”‚   ...                               â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
Step 4: Consume & Transform
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LegacyEventConsumer                 â”‚
â”‚                                     â”‚
â”‚ 1. Check: source == 'sync_service'? â”‚
â”‚    â†’ NO, continue                   â”‚
â”‚ 2. Transform schema                 â”‚
â”‚    username â†’ user_name             â”‚
â”‚    email â†’ email_address            â”‚
â”‚    ...                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
Step 5: Write with UPSERT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IdempotentRevampWriter              â”‚
â”‚                                     â”‚
â”‚ INSERT INTO revamp_users            â”‚
â”‚ VALUES (..., source='sync_service') â”‚
â”‚ ON DUPLICATE KEY UPDATE...          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
Step 6: Loop Prevention
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MySQL CDC (Debezium)                â”‚
â”‚                                     â”‚
â”‚ âœ— Check: source == 'sync_service'  â”‚
â”‚ âœ— FILTER OUT - Don't publish!      â”‚
â”‚                                     â”‚
â”‚ âœ“ LOOP PREVENTED                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 2: Revamp â†’ Legacy

```
Same pattern, reversed direction:

MySQL (source='revamp')
  â†’ Debezium
  â†’ Kafka (revamp.revamp_db.revamp_users)
  â†’ RevampEventConsumer
  â†’ Transform (user_name â†’ username)
  â†’ IdempotentLegacyWriter
  â†’ PostgreSQL (source='sync_service')
  â†’ PostgreSQL CDC FILTERS OUT
  â†’ âœ“ LOOP PREVENTED
```

## ğŸ—‚ï¸ Project Structure Visual

```
sync-DB/
â”‚
â”œâ”€â”€ ğŸ“„ README.md                    â† Start here
â”œâ”€â”€ ğŸ“„ ARCHITECTURE.md              â† System design
â”œâ”€â”€ ğŸ“„ SETUP.md                     â† Installation
â”œâ”€â”€ ğŸ“„ PROJECT-SUMMARY.md           â† Complete overview
â”œâ”€â”€ ğŸ“„ QUICK-REFERENCE.md           â† Command cheat sheet
â”œâ”€â”€ ğŸ“„ DOCUMENTATION-INDEX.md       â† This guide
â”œâ”€â”€ ğŸ“„ VISUAL-GUIDE.md              â† Visual diagrams
â”œâ”€â”€ ğŸ“„ .gitignore
â””â”€â”€ ğŸ“„ docker-compose.yml           â† Infrastructure
â”‚
â”œâ”€â”€ ğŸ“ databases/
â”‚   â”œâ”€â”€ ğŸ“ postgres/                â† Legacy DB
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ README.md
â”‚   â”‚   â””â”€â”€ ğŸ“„ schema.sql           â† PostgreSQL DDL
â”‚   â””â”€â”€ ğŸ“ mysql/                   â† Revamp DB
â”‚       â”œâ”€â”€ ğŸ“„ README.md
â”‚       â”œâ”€â”€ ğŸ“„ schema.sql           â† MySQL DDL
â”‚       â””â”€â”€ ğŸ“„ my.cnf
â”‚
â”œâ”€â”€ ğŸ“ debezium/                    â† CDC Configuration
â”‚   â”œâ”€â”€ ğŸ“„ postgres-connector.json
â”‚   â”œâ”€â”€ ğŸ“„ mysql-connector.json
â”‚   â””â”€â”€ ğŸ“„ register-connectors.sh
â”‚
â”œâ”€â”€ ğŸ“ sync-service/                â† Laravel Application
â”‚   â”œâ”€â”€ ğŸ“„ README.md
â”‚   â”œâ”€â”€ ğŸ“„ composer.json
â”‚   â”œâ”€â”€ ğŸ“„ env.example
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ app/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ Console/Commands/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ConsumeLegacyEvents.php   â† CLI command
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ ConsumeRevampEvents.php   â† CLI command
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ DTOs/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ SyncEvent.php             â† Event contract
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserDTO.php
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PostDTO.php
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ LikeDTO.php
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ Models/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EntityMapping.php         â† ID mapping
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ ProcessedEvent.php        â† Deduplication
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ Services/
â”‚   â”‚       â”œâ”€â”€ ğŸ“ Consumers/
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ BaseConsumer.php
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ LegacyEventConsumer.php
â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“„ RevampEventConsumer.php
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ ğŸ“ Transformers/
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ TransformerInterface.php
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ LegacyToRevampMapper.php
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ RevampToLegacyMapper.php
â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“„ TransformerFactory.php
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ ğŸ“ Writers/
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ IdempotentWriterInterface.php
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ IdempotentLegacyWriter.php
â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“„ IdempotentRevampWriter.php
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ ğŸ“ Handlers/
â”‚   â”‚           â”œâ”€â”€ ğŸ“„ RetryHandler.php       â† Exponential backoff
â”‚   â”‚           â”œâ”€â”€ ğŸ“„ DLQHandler.php         â† Dead letter queue
â”‚   â”‚           â””â”€â”€ ğŸ“„ ErrorHandler.php       â† Centralized errors
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ config/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ kafka.php                      â† Kafka config
â”‚   â”‚   â””â”€â”€ ğŸ“„ database.php                   â† Multi-DB config
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ database/migrations/
â”‚       â”œâ”€â”€ ğŸ“„ ..._create_entity_mappings_table.php
â”‚       â””â”€â”€ ğŸ“„ ..._create_processed_events_table.php
â”‚
â””â”€â”€ ğŸ“ testing/
    â”œâ”€â”€ ğŸ“„ test-scenarios.md            â† Test documentation
    â””â”€â”€ ğŸ“ scripts/
        â”œâ”€â”€ ğŸ“„ test-legacy-to-revamp.sh
        â”œâ”€â”€ ğŸ“„ test-revamp-to-legacy.sh
        â””â”€â”€ ğŸ“„ test-loop-prevention.sh
```

## ğŸ”„ State Machine Diagram

```
Event Processing State Machine:

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   START     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Consume    â”‚
                    â”‚  from Kafka â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Parse Debezium Eventâ”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Check: source == 'sync_service'?â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ YES            â”‚ NO
                   â”‚                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”‚
            â”‚ SKIP Event  â”‚         â”‚
            â”‚ (Loop Prev.)â”‚         â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
                   â”‚                â”‚
                   â”‚                â–¼
                   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚      â”‚ Check: Already   â”‚
                   â”‚      â”‚ Processed?       â”‚
                   â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚           â”‚ YES  â”‚ NO
                   â”‚      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”   â”‚
                   â”‚      â”‚ SKIP  â”‚   â”‚
                   â”‚      â””â”€â”€â”€â”¬â”€â”€â”€â”˜   â”‚
                   â”‚          â”‚       â”‚
                   â”‚          â”‚       â–¼
                   â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚          â”‚  â”‚Transform â”‚
                   â”‚          â”‚  â”‚ Schema   â”‚
                   â”‚          â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                   â”‚          â”‚       â”‚
                   â”‚          â”‚       â–¼
                   â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚          â”‚  â”‚  Write   â”‚
                   â”‚          â”‚  â”‚  UPSERT  â”‚
                   â”‚          â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                   â”‚          â”‚       â”‚
                   â”‚          â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                   â”‚          â”‚  â”‚  Update  â”‚
                   â”‚          â”‚  â”‚ Mappings â”‚
                   â”‚          â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                   â”‚          â”‚       â”‚
                   â”‚          â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
                   â”‚          â”‚  â”‚   Mark   â”‚
                   â”‚          â”‚  â”‚Processed â”‚
                   â”‚          â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                   â”‚          â”‚       â”‚
                   â”‚          â”‚       â–¼
                   â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚          â”‚  â”‚ Commit   â”‚
                   â”‚          â”‚  â”‚ Offset   â”‚
                   â”‚          â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                   â”‚          â”‚       â”‚
                   â–¼          â–¼       â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   SUCCESS        â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

       If ERROR at any step:
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Retry with  â”‚
            â”‚  Backoff     â”‚
            â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                â”‚ OK   â”‚ FAIL
                â”‚      â”‚
                â–¼      â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚SUCCESS â”‚  â”‚Send DLQ â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Component Interactions                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User/App              Debezium           Kafka          Laravel Sync
   â”‚                     â”‚                 â”‚                  â”‚
   â”‚ INSERT              â”‚                 â”‚                  â”‚
   â”‚ (source='legacy')   â”‚                 â”‚                  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>                 â”‚                  â”‚
   â”‚                     â”‚                 â”‚                  â”‚
   â”‚                     â”‚ Capture Change  â”‚                  â”‚
   â”‚                     â”‚ Filter by sourceâ”‚                  â”‚
   â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>                  â”‚
   â”‚                     â”‚                 â”‚                  â”‚
   â”‚                     â”‚                 â”‚ Consume Event    â”‚
   â”‚                     â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
   â”‚                     â”‚                 â”‚                  â”‚
   â”‚                     â”‚                 â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚                     â”‚                 â”‚   â”‚ 1. Parse          â”‚
   â”‚                     â”‚                 â”‚   â”‚ 2. Check Loop     â”‚
   â”‚                     â”‚                 â”‚   â”‚ 3. Transform      â”‚
   â”‚                     â”‚                 â”‚   â”‚ 4. UPSERT         â”‚
   â”‚                     â”‚                 â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   â”‚                     â”‚                 â”‚                  â”‚
   â”‚                     â”‚                 â”‚  Commit Offset   â”‚
   â”‚                     â”‚                 <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                     â”‚                 â”‚                  â”‚
   â”‚ Record in           â”‚                 â”‚                  â”‚
   â”‚ Target DB           â”‚                 â”‚                  â”‚
   â”‚ (source='sync_srv') â”‚                 â”‚                  â”‚
   <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                     â”‚                 â”‚                  â”‚
   â”‚                     â”‚ Sees Change     â”‚                  â”‚
   â”‚                     â”‚ but FILTERS     â”‚                  â”‚
   â”‚                     â”‚ (source=sync_   â”‚                  â”‚
   â”‚                     â”‚  service)       â”‚                  â”‚
   â”‚                     â”‚                 â”‚                  â”‚
   â”‚                     â”‚ âœ— NO EVENT      â”‚                  â”‚
   â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€X       â”‚                  â”‚
   â”‚                     â”‚                 â”‚                  â”‚
   â”‚              âœ“ LOOP PREVENTED         â”‚                  â”‚
   â”‚                                                          â”‚
```

## ğŸ“ˆ Performance Metrics Visual

```
Event Processing Pipeline:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Kafka     â”‚â”€â”€â”€>â”‚  Consumer   â”‚â”€â”€â”€>â”‚ Transform   â”‚â”€â”€â”€>â”‚   Writer    â”‚
â”‚  Consume    â”‚    â”‚   Parse     â”‚    â”‚   Schema    â”‚    â”‚   UPSERT    â”‚
â”‚             â”‚    â”‚             â”‚    â”‚             â”‚    â”‚             â”‚
â”‚  ~5-10ms    â”‚    â”‚   ~1-3ms    â”‚    â”‚   ~2-5ms    â”‚    â”‚  ~10-30ms   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Latency: ~20-50ms per event (excluding network I/O)

Throughput:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Single Consumer: 100-500 eps  â”‚ (events per second)
â”‚ 3 Parallel: 300-1500 eps      â”‚
â”‚ 10 Parallel: 1000-5000 eps    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›¡ï¸ Loop Prevention Layers

```
Layer 1: Debezium Filter (Primary)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Debezium Connector               â”‚
â”‚                                  â”‚
â”‚ transforms.filter.condition:     â”‚
â”‚ "value.source != 'sync_service'" â”‚
â”‚                                  â”‚
â”‚ âœ“ Events never reach Kafka      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
      (If bypassed)
           â”‚
           â–¼
Layer 2: Consumer Check (Backup)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BaseConsumer                     â”‚
â”‚                                  â”‚
â”‚ if ($event->shouldSkip()) {      â”‚
â”‚   return; // Skip                â”‚
â”‚ }                                â”‚
â”‚                                  â”‚
â”‚ âœ“ Defense in depth               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ Color Legend

In the diagrams above:

- **â†’** : Data flow
- **âœ“** : Success/Approved
- **âœ—** : Filtered/Rejected
- **ğŸ“„** : File
- **ğŸ“** : Directory
- **â†** : Important note
- **X** : Blocked/Prevented

---

**Visual Guide Version**: 1.0  
**Last Updated**: January 8, 2026


